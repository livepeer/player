<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Livepeer Player</title>
    <!-- <script src="lib/reportGenericVideoMetrics.js"></script> -->

    <link href="lib/videojs@7.18.1.css" rel="stylesheet" />
    <link href="lib/videojs-themes@1.0.1-city.css" rel="stylesheet">
    <link href="lib/videojs-themes@1.0.1-fantasy.css" rel="stylesheet">
    <link href="lib/videojs-themes@1.0.1-forest.css" rel="stylesheet">
    <link href="lib/videojs-themes@1.0.1-sea.css" rel="stylesheet">
    <link href="index.css" rel="stylesheet" />
  </head>
  <body>
    <!-- <script>
      function createReportingUrl(video) {
        //for this example's sake, re-construct the info ws url so there's somewhere to report to
        console.log(video);
        let url = "wss://sao-canary-catalyst-0.livepeer.fun/";
        let filename = video.currentSrc.split("/");
        console.log(video.currentSrc);
        filename = filename[filename.length-1];
        url += "json_"+filename.split(".")[0]+".js";
        console.log("url is ", url);
        return url;
      }

      //this way, we won't gather future additions to the DOM tree
      functionsetTimeout(function(){

        //gather all html5 video and audio 
        let vs = document.querySelectorAll("video,audio");
        for (let i = 0; i < vs.length; i++) {
          reportGenericVideoMetrics(vs[i],createReportingUrl(vs[i]));
        }

        //also supports reporting to multiple websockets
        if (!reportGenericVideoMetrics(vs[0],"wss://sao-canary-catalyst-0.livepeer.fun/json_live.js")) { 
          console.warn("Failed to attach to another reporting server");
        }

        //but won't attach twice
        if (!reportGenericVideoMetrics(vs[0],"wss://sao-canary-catalyst-0.livepeer.fun/json_live.js")) {
          console.warn("Failed to attach to the same reporting server");
        }

      },1e3);

      //alternatively we could let the video elements come to us...
      //..but we won't find elements that fail to load
      document.body.addEventListener("loadstart",function(e){
        reportGenericVideoMetrics(e.target,createReportingUrl(e.target));
      },true);

    </script> -->
    <video
      id="video"
      class="video-js vjs-big-play-centered"
      controls
      preload="auto"
    >
      <p class="vjs-no-js">
        To view this video please enable JavaScript, and consider upgrading to a
        web browser that
        <a href="https://videojs.com/html5-video-support/" target="_blank">
          supports HTML5 video
        </a>
      </p>
    </video>
    <script src="lib/videojs@7.18.1.min.js"></script>
    <script src="lib/videojs-contrib-quality-levels@2.1.0.min.js"></script>
    <script src="lib/videojs-hls-quality-selector@1.1.4.min.js"></script>
    <script src="index.js"></script>
  </body>
</html>
